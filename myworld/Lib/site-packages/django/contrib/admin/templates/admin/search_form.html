{% load i18n static %}
{% if cl.search_fields %}
<div id="toolbar">

<form id="changelist-search" method="get" role="search">
    <div><!-- DIV needed for valid HTML -->
        <label for="{{ field }}_searchbar"><img src="{% static "admin/img/search.svg" %}" alt="Search"></label>

        {% comment %} {% for field in cl.search_fields %}
            <input type="text" size="20" name="{{ field }}__icontains" value="{{ request.GET|default:'' }}" id="{{ field }}_searchbar" placeholder="{% trans 'Search by' %} {{ field|capfirst }}">
        {% endfor %} {% endcomment %}

        {% comment %} --------custom  code 20240129 ----------- {% endcomment %}
        {% for field in cl.search_fields %}
        {% if field == "status" %}
                <!-- Dropdown cho trường "status" -->
                <select name="{{ field }}__exact" id="{{ field }}_searchbar">
                    {% comment %} <option value="" {% if not request.GET.status__exact %}selected{% endif %}>-- Select {{ field|capfirst }} --</option> {% endcomment %}
                    <option value="0" {% if request.GET.status__exact == "0" %}selected{% endif %}>0</option>
                    <option value="1" {% if request.GET.status__exact == "1" %}selected{% endif %}>1</option>
                    <option value="2" {% if request.GET.status__exact == "2" %}selected{% endif %}>2</option>
                </select>
            {% else %}
                <!-- Input text cho các trường khác -->
                <input type="text" size="20" name="{{ field }}__icontains" value="{{ request.GET|default:'' }}" id="{{ field }}_searchbar" placeholder="{% trans 'Search by' %} {{ field|capfirst }}">
            {% endif %}
        {% endfor %}


        {% comment %} hết custom code 20240129  {% endcomment %}

        <input type="submit" value="{% translate 'Search' %}" class="search-button">
        <input type="button" value="Đặt lại" class="clear-results-button" onclick="clearSearchResults()" style="color:white;height: 26px;font-size:13px">
    </div>

        <!-- ---------het custom code ----------  -->
{% if cl.search_help_text %}
<br class="clear">
<div class="help" id="searchbar_helptext">{{ cl.search_help_text }}</div>
{% endif %}
</form></div>
<script>
    function getParameterValue(parameterName) {
        const urlSearchParams = new URLSearchParams(window.location.search);
        return urlSearchParams.get(parameterName);
    }

    // Lấy giá trị của tham số từ URL
    {% for field in cl.search_fields %}
        var original{{ field|title }}Value = getParameterValue('{{ field }}__icontains');
    {% endfor %}
    // Gọi hàm restoreSearchValues khi trang load để giữ nguyên giá trị khi search
    restoreSearchValues();
    // Lấy giá trị của status__exact từ URL
    var originalStatusValue = getParameterValue('status__exact');
    console.log("hi",originalStatusValue)
    function restoreSearchValues() {
        {% for field in cl.search_fields %}
            // Set giá trị từ biến original
            document.getElementById('{{ field }}_searchbar').value = original{{ field|title }}Value;
        {% endfor %}

        // Set giá trị cho dropdown status__exact nếu có
        if (originalStatusValue !== null) {
            document.getElementById('status_searchbar').value = originalStatusValue;
        }
    }
    function clearSearchResults() {
        // Đặt giá trị trống cho ô tìm kiếm và gửi form
        {% for field in cl.search_fields %}
            document.getElementById('{{ field }}_searchbar').value = '';
        {% endfor %}
        document.getElementById('status_searchbar').value = '';
        document.getElementById('changelist-search').submit();
    }

    // Code để thêm giá trị mặc định vào cho dropdown 29-01-2024
    document.addEventListener("DOMContentLoaded", function () {
    // Kiểm tra nếu giá trị của dropdown trống
    {% if cl.search_fields.1 == 'status' %}  // Chỉ áp dụng cho trường thứ 2
        if (!document.getElementById('{{ cl.search_fields.1 }}_searchbar').value) {
            // Thêm một tùy chọn mặc định vào đầu dropdown
            var defaultOption = document.createElement('option');
            defaultOption.value = '';
            if (originalStatusValue !== null){
                defaultOption.text = 'Searched status: ' +originalStatusValue
            }else{
                defaultOption.text = '-- Select a Status --';
            }
            defaultOption.selected = true;
            document.getElementById('{{ cl.search_fields.1 }}_searchbar').appendChild(defaultOption);
        }
    {% endif %}
    });
</script>
{% endif %}
